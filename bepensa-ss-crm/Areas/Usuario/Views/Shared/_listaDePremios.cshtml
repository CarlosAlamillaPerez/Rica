@model CarritoDTO

<div class="row">
    <div class="order-history table-responsive wishlist">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th></th>
                    <th>Premio</th>
                    <th>SKU</th>
                    <th>Puntos</th>
                    <th>Cantidad</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Carrito != null && Model.Carrito.Count > 0)
                {
                    @foreach (var premio in Model.Carrito)
                    {
                        <tr>
                            <td><img class="img-fluid img-40" src="@premio.Imagen" alt="@premio.Imagen"></td>
                            <td>
                                <div class="product-name">
                                    @premio.Nombre
                                    @if (premio.TelefonoRecarga != null)
                                    {
                                        <span><b>(@premio.TelefonoRecarga)</b></span>
                                    }

                                    @if (premio.Tarjeta != null && premio.Tarjeta.Count() > 0)
                                    {
                                        List<string> tarjetas = premio.Tarjeta.Split(',').Select(t => t.Trim()).ToList();
                                        <p>
                                            @foreach (var tajeta in tarjetas)
                                            {
                                                var tarjetaFormateada = string.Join(" ",
                                                Enumerable.Range(0, tajeta.Length / 4)
                                                .Select(i => tajeta.Substring(i * 4, Math.Min(4, tajeta.Length - i * 4)))
                                                );

                                                <span><b>(@tarjetaFormateada)</b></span>
                                            }
                                        </p>
                                    }
                                </div>
                            </td>
                            <td>@premio.Sku</td>
                            <td><b>@premio.Puntos.ToString("N0")</b></td>
                            <td>
                                <div class="d-flex align-items-center justify-content-between">
                                    <button class="border-0 menos" data-premio="@premio.IdPremio">-</button>
                                    <div style="width: 40px;">@premio.Cantidad</div>
                                    <button class="border-0 mas" data-premio="@premio.IdPremio">+</button>
                                </div>
                            </td>
                            <td>
                                <button class="btn text-reset bg-transparent border-0 p-0 eliminar" data-premio="@premio.IdPremio"><i class="fa fa-trash font-20px"></i></button>
                            </td>
                        </tr>
                    }
                    <tr>
                        <td colspan="6" class="text-center">

                            <div class="row">
                                <div class="col-12 text-center pb-3">
                                    <h6>Total</h6>
                                    <h6>@Model.Total.ToString("N0") Pts.</h6>
                                </div>

                                @if (Model.MontoPendiente == null || Model.MontoPendiente <= 0.0m)
                                {
                                    <div class="col-6">
                                        <button class="btn btn-outline-info rounded-pill me-2 d-lg-block w-100 vaciar-carrito">Cancelar</button>
                                    </div>
                                    <div class="col-6">

                                        <a class="btn btn-primary text-white rounded-pill d-lg-block w-100" asp-action="Store" asp-controller="Carrito" asp-area="Usuario">Siguiente</a>
                                    </div>
                                }
                            </div>
                        </td>
                    </tr>
                }
                else
                {
                    <tr>
                        <td colspan="6">CARRITO VACÍO</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>