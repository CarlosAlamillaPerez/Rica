@model ResumenSocioSelectoDTO
@inject IPremio _premio

@{
    var header = ViewContext.HttpContext.Response.Headers["Content-Security-Policy"];
    var regex = new System.Text.RegularExpressions.Regex(@"script-src\s+.*nonce-(?<nonce>[a-zA-Z0-9]+)'");
    var match = regex.Match(header);
    var nonce = match.Groups["nonce"];
    ViewBag.Nonce = nonce;

    Layout = null;

    var metaMensual = Model.MetaMensual;

    var portaPrioritario = Model.PortafolioPrioritario;

    var edoCta = Model.EstadoCuenta;

    var premios = _premio.ConsultarPremiosByPuntos(edoCta.PuntosDisponibles).Data;

    string urlApp = "https://socioselecto-bepensa.com/trx9t3";

    string urlWeb = "https://socioselecto-bepensa.com/trx9t2";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen Socio Selecto</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="~/slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="~/slick/slick-theme.css" />
    <link rel="stylesheet" href="~/css/style.css">
</head>
<body>
    <!-- Header -->
    <div class="bg-primary-red">
        <img src="~/img/bg-header.svg" class="" alt="" srcset="">
    </div>

    <!-- Black Bar -->
    <div class="bg-dark text-white py-2">
        <div class="container px-4 py-4">
            <h1 class="fs-5 mb-0 fw-semibold text-center">Resumen Socio Selecto</h1>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container px-4 py-4">
        <p class="text-center mb-3 font-13px">Conoce tus avances en los diferentes rubros de acumulación</p>

        <div class="row g-4 justify-content-center">
            <!-- Meta de julio Card -->
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card border-0 rounded-5">
                    <div class="card-header border-0 bg-primary-red text-white py-3 rounded-5 rounded-bottom-0">
                        <h2 class="text-center fs-6 mb-0">Meta de julio</h2>
                    </div>
                    <div class="card-body px-4 text-center">
                        @if (metaMensual != null)
                        {
                            <h1 class="text-primary">$@metaMensual.Meta.ToString("N2")</h1>
                            <hr>
                            <h1 class="text-success">@metaMensual.Porcentaje%</h1>
                            <hr>
                            <p class="mb-0">Avance actual</p>
                            <h1>$@metaMensual.ImporteComprado.ToString("N2")</h1>
                        }
                        else
                        {
                            <h1 class="text-primary">$0</h1>
                            <hr>
                            <h1 class="text-success">0%</h1>
                            <hr>
                            <p class="mb-0">Avance actual</p>
                            <h1>$0</h1>
                        }
                    </div>
                </div>
            </div>
            <!-- Portafolio prioritario -->
            <div class="col-12 col-md-6 col-lg-8">
                <div class="card border-0 rounded-5">
                    <div class="card-header border-0 bg-primary-red text-white py-3 rounded-5 rounded-bottom-0">
                        <h2 class="text-center fs-6 mb-0">Portafolio prioritario</h2>
                    </div>
                    <div class="card-body p-0 rounded-4 rounded-top-0 overflow-hidden">
                        <div class="bg-gris py-3">
                            <div class="row text-center">
                                <div class="col-9">Categoría</div>
                                <div class="col-3">Avance</div>
                            </div>
                        </div>
                        <div class="bg-light rounded-3">

                            <div class="row g-0">
                                @if (portaPrioritario != null)
                                {
                                    foreach (var pp in portaPrioritario)
                                    {
                                        <div class="col-12 col-md-6 col-lg-3">
                                            <div class="category-item">
                                                <span class="category-badge" style="background-color: @pp.FondoColor">@pp.Nombre</span>
                                                <span class="category-percentage" style="color: @pp.FondoColor">@pp.Porcentaje%</span>
                                            </div>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="col-12">
                                        <div class="category-item">
                                            <span class="category-badge bg-primary-red">No hay portafolio prioritario asignado.</span>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Foto de éxito -->
            @* <div class="col-12 col-md-6 col-lg-4">
            <div class="card border-0 rounded-5">
            <div class="card-header border-0 bg-primary-red text-white py-3 rounded-5 rounded-bottom-0">
            <div class="d-flex justify-content-center align-items-center">
            <img src="~/img/ic-foto-exito.svg" alt="" srcset="">
            <h2 class="text-center fs-6 mb-0">Foto de éxito</h2>
            </div>
            </div>
            <div class="card-body px-2 text-center">
            <div class="row">
            <div class="col-6 border-end">
            <p class="mb-0">Has comprado</p>
            <p class="mb-0 text-primary-red"><b>4</b> productos de <b>6</b></p>
            </div>
            <div class="col-6">
            <p class="mb-0">Avance actual</p>
            <p class="mb-0 text-success"><b>66%</b></p>
            </div>
            </div>
            </div>
            </div>
            </div> *@

            <!-- Compra digital -->
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card border-0 rounded-5">
                    <div class="card-header border-0 bg-primary-red text-white py-3 rounded-5 rounded-bottom-0">
                        <div class="d-flex justify-content-center align-items-center">
                            <img src="~/img/ic-compra-digital.svg" alt="" srcset="">
                            <h2 class="text-center fs-6 mb-0">Compra digital</h2>
                        </div>
                    </div>
                    <div class="card-body px-2 text-center">
                        <small class="mb-0">Has realizado desde la App Bepensa el</small>
                        @if (metaMensual != null)
                        {

                            int porcentajeCD = 0;

                            if (metaMensual.ImporteComprado != 0)
                            {
                                porcentajeCD = (int)(metaMensual.CompraDigital * 100 / metaMensual.ImporteComprado);
                            }

                            <p><b>@porcentajeCD.ToString()%</b> de tu compras</p>
                        }
                        else
                        {
                            <p><b>0%</b> de tu compras</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="section-points-card">
        <div class="container">
            <div class="row justify-content-center">
                <!-- Points Section -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="d-flex flex-column gap-4 ">
                        <div class="points-card d-flex justify-content-between align-items-center flex-column d-flex">
                            <span>Saldo anterior</span>
                            <span class="points-value">@(edoCta?.SaldoAnterior != null ? edoCta.SaldoAnterior.ToString("N0") : "0") Pts.</span>
                        </div>
                        <div class="points-card d-flex justify-content-between align-items-center flex-column d-flex">
                            <span>Ganados en el mes</span>
                            <span class="points-value">@(edoCta?.AcumuladoActual != null ? edoCta.AcumuladoActual.ToString("N0") : "0") Pts.</span>
                        </div>
                        <div class="points-card d-flex justify-content-between align-items-center flex-column d-flex">
                            <span>Puntos disponibles</span>
                            <span class="points-value">@(edoCta?.PuntosDisponibles != null ? edoCta.PuntosDisponibles.ToString("N0") : "0") Pts.</span>
                        </div>
                        <div class="points-card d-flex justify-content-between align-items-center flex-column d-flex">
                            <span>Puntos canjeados</span>
                            <span class="points-value">@(edoCta?.PuntosCanjeados != null ? edoCta.PuntosCanjeados.ToString("N0") : "0") Pts.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slick Cards -->

    <div class="container my-5">
        <div class="row">
            <div class="col-12">
                <div class="responsive  slider_4  text-center">
                    @if (premios != null)
                    {
                        foreach (var premio in premios)
                        {
                            <div class="h-100 rounded-5 overflow-hidden border-0 bg-transparent">
                                <div class="card mx-3 rounded-5 rounded-bottom-0 overflow-hidden border-0  bg-transparent ">
                                    <div class="card-body rounded-5 rounded-bottom-0 overflow-hidden bg-white">
                                        <img src="@premio.Imagen" class="img-fluid w-auto mx-auto position-relative ratio" style="height: 200px;" height="300" alt="" srcset="" data-aos="fade-in" data-aos-delay="100">
                                        <p>@premio.Nombre</p>
                                    </div>
                                    <div class="card-footer bg-dark text-white rounded-5 rounded-top-0 overflow-hidden">
                                        <h5>@premio.Puntos.ToString("N0") Pts.</h5>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <!-- Footer Buttons -->
    <div class="container mb-4">
        <div class="row justify-content-center g-3">
            <div class="col-12 text-center mb-3">
                <p class="text-secondary small">Si quieres revisar más detalles lo puedes hacer desde la App o Sitio web</p>
            </div>
            <div class="col-12 col-md-6 col-lg-4">
                <a href="@urlApp" class="btn btn-primary w-100 py-3" target="_blank">App</a>
            </div>
            <div class="col-12 col-md-6 col-lg-4">
                <a href="@urlWeb" class="btn btn-primary w-100 py-3" target="_blank">Sitio web</a>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script nonce="@ViewBag.Nonce" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script nonce="@ViewBag.Nonce" type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script nonce="@ViewBag.Nonce" type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script nonce="@ViewBag.Nonce" src="~/slick.min.js"></script>
    <script nonce="@ViewBag.Nonce" src="~/slick.js"></script>
</body>
</html>
